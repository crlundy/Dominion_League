---
layout: default
---

<div class="home">
  <div id="player-database" class="container-centered">
    <h3>Player Database</h3>
    <h5><a href="{{site.baseurl}}/past_standings.html">View All Past Season Standings</a></h5>
    <p> Search for a player (eg. Mic Qsenoch) and view their league history for all seasons they've participated in. </p>
    <div class="spacing"> </div>
    <!--
    <select name="order" id="order">
      <option value="desc">Descending</option>
      <option value="asc">Ascending</option>
    </select>
    -->
    <input class="input-player" type="text" id="player_search" placeholder="Search for player name" />
    <br>
    <button onclick="searchPlayerHistory()">Search</button>
    <br>
    <br>
  </div>
</div>

<script>
var myContacts = [
	  { "name": "Parvez Ansari", "email": "ansariparvez@gmai.com", "mobile":"9998979695" },
	  { "name": "Tayyeb Shaikh", "email": "tshaikh1981@gmai.com", "mobile":"9091929394" },
	  { "name": "Ashfaque Shaikh", "email": "ashly786@gmai.com", "mobile":"8081828384" }
	];

// Data for tables
var players_and_seasons = {{ site.data.player_and_seasons_played | jsonify }};
var friendly_league_history = {{ site.data.friendly_league_history | jsonify }};
var league_history = friendly_league_history["seasons"];

let first_search = true;
let cache_children = 0;

// Generate search results
function searchPlayerHistory(){

    var divContainer = document.getElementById("player-database");
    for (var k = 0; k < cache_children; k++){
      divContainer.removeChild(divContainer.lastChild);
    }
    cache_children = 0;

    var player_name = document.getElementById("player_search").value;
    //var order = document.getElementById("order").value;
    player_name = player_name.toLowerCase();
    let player_seasons = players_and_seasons[player_name];
    player_seasons = player_seasons.slice().reverse();
    console.log(player_seasons);

    var num_seasons = player_seasons.length;

    // No data exists for player
    if (num_seasons < 1) {
      // Do something "No data exists for this player"



    // Generate table for each season played
    } else {
      // Iterate through all seasons the player has played
      console.log(num_seasons);
      for (let i = 0; i < num_seasons; i++) {
        var season = player_seasons[i]["season"]; // Eg. "1"
        var division = player_seasons[i]["division"]; // Eg. "A1"
        console.log(season + " " + division);

        // Get Table Information
        var division_data = league_history[season][division];
        var division_members = division_data["members"];
        var num_members = Object.keys(division_members).length
        // TODO: add champion information

        // Create table
        var table = document.createElement("table");
        table.classList.add('table-player-database');
        //table.style.marginBottom = "10px";
        table.setAttribute('align', 'center');
        table.setAttribute('border', '2px solid grey');

        // Create division heading
        var division_row = document.createElement("tr");
        var division_heading = document.createElement("td");
        division_heading.setAttribute('colspan', 5);
        division_heading.classList.add('division-header');
        var season_url = "<a href=\"past_standings/season" + season + "_past_standings.html\">Season " + season + "</a>";
        division_heading.innerHTML = season_url + " " + division+ " Division";
        division_heading.style.backgroundColor = "lightgrey";
        division_row.appendChild(division_heading);
        table.appendChild(division_row);


        // Create table heading
        var col = ["Rank", "Player", "W", "L", "Win %"];
        var col_width = ["10%", "55%", "10%", "10%", "15%"];
        var h_row = document.createElement("tr");
        for (let j = 0; j < col.length; j++) {
            var th = document.createElement("th");
            th.innerHTML = col[j];
            th.style.width = col_width[j];
            h_row.appendChild(th);
        }
        h_row.style.backgroundColor = "#e0e0e0";
        table.appendChild(h_row);

        // Create table body
        // ADD COLUMN HEADER TO ROW OF TABLE HEAD.
        for (var key in division_members) {
            var row_info = division_members[key];

            var d_row = document.createElement("tr");

            // Add data for each member
            var rank = document.createElement("td");
            rank.innerHTML = row_info["rank"];
            d_row.appendChild(rank);
            var player = document.createElement("td");
            if (row_info["name"].toLowerCase() == player_name) {
              player.innerHTML = "<b>" + row_info["name"] + "</b>";
            } else {
              player.innerHTML = row_info["name"];
            }
            d_row.appendChild(player);
            var wins = document.createElement("td");
            wins.innerHTML = row_info["wins"];
            d_row.appendChild(wins);
            var losses = document.createElement("td");
            losses.innerHTML = row_info["losses"];
            d_row.appendChild(losses);
            var pct = document.createElement("td");
            pct.innerHTML = row_info["pct"];
            pct.style.backgroundColor = row_info["color"];
            d_row.appendChild(pct);

            table.appendChild(d_row)

        }

        // Add table to container
        divContainer.appendChild(table);
        cache_children = cache_children + 1;
      }
    }
}

</script>
